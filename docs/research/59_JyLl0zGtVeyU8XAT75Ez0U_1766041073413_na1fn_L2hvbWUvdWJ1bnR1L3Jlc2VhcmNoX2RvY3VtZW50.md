# Research on Database Schema for Chat and AI Conversation Tracking

This document outlines a database schema for a chat and AI conversation tracking system for the Greenists event management platform in Aden, Yemen. The schema is designed to be comprehensive, scalable, and ready for production use.

## 1. Core Requirements

The schema is designed to meet the following requirements:

*   **User Management:** Store user information, including names in both English and Arabic, contact details, and preferences.
*   **Conversation Tracking:** Track all conversations, whether between two users, in a group, or with an AI agent.
*   **Message Logging:** Log every message sent, including text, attachments, and metadata.
*   **AI Interaction:** Specifically track interactions with AI agents, including the prompts, responses, and any feedback provided by the user.
*   **WhatsApp Integration:** Store WhatsApp numbers as a primary contact method.
*   **Localization:** Support for Arabic language and Yemeni Rial (YER) as a currency.

## 2. Database Schema

The proposed schema consists of the following tables:

*   `users`
*   `conversations`
*   `conversation_participants`
*   `messages`
*   `message_attachments`
*   `ai_interactions`
*   `user_sessions`

### 2.1. `users` Table

This table stores information about the users of the platform.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `user_id` | `INT` (Primary Key) | Unique identifier for each user. |
| `username` | `VARCHAR(255)` | Unique username for the user. |
| `full_name` | `VARCHAR(255)` | User's full name in English. |
| `full_name_ar` | `VARCHAR(255)` | User's full name in Arabic (الاسم بالعربي). |
| `email` | `VARCHAR(255)` | User's email address. |
| `whatsapp_number` | `VARCHAR(20)` | User's WhatsApp number. |
| `profile_picture_url` | `TEXT` | URL to the user's profile picture. |
| `created_at` | `TIMESTAMP` | Timestamp of when the user account was created. |
| `updated_at` | `TIMESTAMP` | Timestamp of the last update to the user's profile. |

### 2.2. `conversations` Table

This table stores information about each conversation.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `conversation_id` | `INT` (Primary Key) | Unique identifier for each conversation. |
| `conversation_type` | `ENUM('private', 'group', 'ai')` | Type of conversation. |
| `created_at` | `TIMESTAMP` | Timestamp of when the conversation was created. |

### 2.3. `conversation_participants` Table

This table links users to conversations, creating a many-to-many relationship.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `participant_id` | `INT` (Primary Key) | Unique identifier for each participant record. |
| `conversation_id` | `INT` (Foreign Key) | Foreign key referencing the `conversations` table. |
| `user_id` | `INT` (Foreign Key) | Foreign key referencing the `users` table. |
| `joined_at` | `TIMESTAMP` | Timestamp of when the user joined the conversation. |

### 2.4. `messages` Table

This table stores the content of each message.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `message_id` | `INT` (Primary Key) | Unique identifier for each message. |
| `conversation_id` | `INT` (Foreign Key) | Foreign key referencing the `conversations` table. |
| `sender_id` | `INT` (Foreign Key) | Foreign key referencing the `users` table. |
| `message_text` | `TEXT` | The content of the message. |
| `sent_at` | `TIMESTAMP` | Timestamp of when the message was sent. |

### 2.5. `message_attachments` Table

This table stores information about any attachments sent with a message.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `attachment_id` | `INT` (Primary Key) | Unique identifier for each attachment. |
| `message_id` | `INT` (Foreign Key) | Foreign key referencing the `messages` table. |
| `attachment_url` | `TEXT` | URL to the attachment file. |
| `attachment_type` | `VARCHAR(50)` | Type of attachment (e.g., 'image', 'video', 'pdf'). |

### 2.6. `ai_interactions` Table

This table logs all interactions with AI agents.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `interaction_id` | `INT` (Primary Key) | Unique identifier for each AI interaction. |
| `conversation_id` | `INT` (Foreign Key) | Foreign key referencing the `conversations` table. |
| `user_id` | `INT` (Foreign Key) | Foreign key referencing the `users` table. |
| `prompt` | `TEXT` | The prompt given to the AI by the user. |
| `response` | `TEXT` | The response generated by the AI. |
| `feedback` | `ENUM('positive', 'negative', 'none')` | User feedback on the AI's response. |
| `created_at` | `TIMESTAMP` | Timestamp of the interaction. |

### 2.7. `user_sessions` Table

This table tracks user sessions for analytics and to provide a better user experience.

| Column Name | Data Type | Description |
| --- | --- | --- |
| `session_id` | `INT` (Primary Key) | Unique identifier for each session. |
| `user_id` | `INT` (Foreign Key) | Foreign key referencing the `users` table. |
| `started_at` | `TIMESTAMP` | Timestamp of when the session started. |
| `ended_at` | `TIMESTAMP` | Timestamp of when the session ended. |
| `device_info` | `TEXT` | Information about the user's device. |


## 3. SQL Schema

```sql
CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    full_name_ar VARCHAR(255),
    email VARCHAR(255) UNIQUE NOT NULL,
    whatsapp_number VARCHAR(20) UNIQUE,
    profile_picture_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE conversations (
    conversation_id INT PRIMARY KEY AUTO_INCREMENT,
    conversation_type ENUM('private', 'group', 'ai') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE conversation_participants (
    participant_id INT PRIMARY KEY AUTO_INCREMENT,
    conversation_id INT,
    user_id INT,
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(conversation_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE messages (
    message_id INT PRIMARY KEY AUTO_INCREMENT,
    conversation_id INT,
    sender_id INT,
    message_text TEXT NOT NULL,
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(conversation_id),
    FOREIGN KEY (sender_id) REFERENCES users(user_id)
);

CREATE TABLE message_attachments (
    attachment_id INT PRIMARY KEY AUTO_INCREMENT,
    message_id INT,
    attachment_url TEXT NOT NULL,
    attachment_type VARCHAR(50),
    FOREIGN KEY (message_id) REFERENCES messages(message_id)
);

CREATE TABLE ai_interactions (
    interaction_id INT PRIMARY KEY AUTO_INCREMENT,
    conversation_id INT,
    user_id INT,
    prompt TEXT NOT NULL,
    response TEXT NOT NULL,
    feedback ENUM('positive', 'negative', 'none') DEFAULT 'none',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(conversation_id),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE user_sessions (
    session_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ended_at TIMESTAMP,
    device_info TEXT,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

## 4. Sample Data

Here is some sample data for each of the tables in JSON format.

### 4.1. `users`

```json
[
  {
    "user_id": 1,
    "username": "john.doe",
    "full_name": "John Doe",
    "full_name_ar": "جون دو",
    "email": "john.doe@example.com",
    "whatsapp_number": "+967777123456",
    "profile_picture_url": "https://example.com/profiles/john.jpg"
  },
  {
    "user_id": 2,
    "username": "fatima.ali",
    "full_name": "Fatima Ali",
    "full_name_ar": "فاطمة علي",
    "email": "fatima.ali@example.com",
    "whatsapp_number": "+967777654321",
    "profile_picture_url": "https://example.com/profiles/fatima.jpg"
  }
]
```

### 4.2. `conversations`

```json
[
  {
    "conversation_id": 1,
    "conversation_type": "private"
  },
  {
    "conversation_id": 2,
    "conversation_type": "ai"
  }
]
```

### 4.3. `conversation_participants`

```json
[
  {
    "participant_id": 1,
    "conversation_id": 1,
    "user_id": 1
  },
  {
    "participant_id": 2,
    "conversation_id": 1,
    "user_id": 2
  },
  {
    "participant_id": 3,
    "conversation_id": 2,
    "user_id": 1
  }
]
```

### 4.4. `messages`

```json
[
  {
    "message_id": 1,
    "conversation_id": 1,
    "sender_id": 1,
    "message_text": "Hello Fatima, how are you?"
  },
  {
    "message_id": 2,
    "conversation_id": 1,
    "sender_id": 2,
    "message_text": "Hi John, I am fine, thank you! How about you?"
  }
]
```

### 4.5. `ai_interactions`

```json
[
  {
    "interaction_id": 1,
    "conversation_id": 2,
    "user_id": 1,
    "prompt": "What are the best event venues in Aden?",
    "response": "Some of the best event venues in Aden include the Coral Hotel, the Al-Qasr Hotel, and the Sheraton Gold Mohur.",
    "feedback": "positive"
  }
]
```
